language: java
jdk: oraclejdk8
branches:
  only:
  - master
services:
  - mysql
  - redis-server
before_install:
  - sudo mysql -e "create database casbin;"
install: true
before_script:
  - chmod +x ./gradlew
script:
  - "./gradlew build --parallel --scan -s"
after_success:
  - bash <(curl -s https://codecov.io/bash)
cache:
  directories:
    - "$HOME/.gradle/caches/"
    - "$HOME/.gradle/wrapper/"
before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
deploy:
  provider: bintray
  user: fangzhengjin
  key:
    secure: rlyly92wOr+dU0LpT+yPd8zHPrmEEewfAsi37xFbVSbLh+7FK+Tlp/HAib0M1MxcRZM1E6Vvdqmv2Av0lYpP7jNw9XmzyKWLF91NeuwXM5Imx/pl7a5of9jcxruupEgBmESwUKkyFe0Kzla6f2pZgW//zSdbXS3bSbYOP1IrlFLgZXhpBXJQUzJ5dRlqp5EwXlcMmvTWrRcu7Jxzp4jZGa8l7KgRcJm7QSgB4KqO6hE1o0QEt2n/vZ1ApDDMaYieBSPN3+mLx1Y9xsAan4cgTUd3qVKLoFShXht27KBBA1CsJvyoSCzuCPoAEz6BD/P+trvnYtcogowrGegoRrwOInGFndBgOb9kfvk765+iR6DIRR3zJlQQzvbLE0ZbjzgWVtU6vplRLzXXn41TtCg39RAQFGIROlwNukXwHoKp6ZaWWt2faSkLDZNewL2YNEbA97oSBO4CaiMmDUJO89+JSFoQHZ5RUORO4SuhNz1hwtanEypup3/IohaG7h/X8F0h5ukeR41x8tzcRIk5GYxgsfUAV5cUuB2dKvKp0hmLL4uMhuPcR6iC9dCu4wht5scrKXfCqzHqkNc4OFOAw/DAnnHCBBcL3NQD3suKJ0OLB1+ZhA8OcdVQxnUrE8woGsaH4lqdTJS8b5A568KGAcxX7RcMjUSudzaUUbznuRyqlPE=
  skip_cleanup: true
  file: build/descriptor.json
  on:
    tags: true
    jdk: oraclejdk8
    branch: master
